L.Control.BetterScale=L.Control.extend({options:{position:"bottomleft",maxWidth:150,metric:!1,imperial:!0,updateWhenIdle:!1},onAdd:function(a){this._map=a;var b="leaflet-control-better-scale",c=L.DomUtil.create("div",b),d=this.options,e=L.DomUtil.create("div",b+"-ruler",c);return L.DomUtil.create("div",b+"-ruler-block "+b+"-upper-first-piece",e),L.DomUtil.create("div",b+"-ruler-block "+b+"-upper-second-piece",e),L.DomUtil.create("div",b+"-ruler-block "+b+"-lower-first-piece",e),L.DomUtil.create("div",b+"-ruler-block "+b+"-lower-second-piece",e),this._addScales(d,b,c),this.ScaleContainer=c,a.on(d.updateWhenIdle?"moveend":"move",this._update,this),a.whenReady(this._update,this),c},onRemove:function(a){a.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(a,b,c){this._iScale=L.DomUtil.create("div",b+"-label-div",c),this._iScaleLabel=L.DomUtil.create("div",b+"-label",this._iScale),this._iScaleFirstNumber=L.DomUtil.create("div",b+"-label "+b+"-first-number",this._iScale),this._iScaleSecondNumber=L.DomUtil.create("div",b+"-label "+b+"-second-number",this._iScale)},_update:function(){var a=this._map.getBounds(),b=a.getCenter().lat,c=6378137*Math.PI*Math.cos(b*Math.PI/180),d=c*(a.getNorthEast().lng-a.getSouthWest().lng)/180,e=this._map.getSize(),f=this.options,g=0;e.x>0&&(g=d*(f.maxWidth/e.x)),this._updateScales(f,g)},_updateScales:function(a,b){a.metric&&b&&this._updateMetric(b),a.imperial&&b&&this._updateImperial(b)},_updateMetric:function(a){var b=this._getRoundNum(a);this._mScale.style.width=this._getScaleWidth(b/a)+"px",this._mScale.innerHTML=1e3>b?b+" m":b/1e3+" km"},_updateImperial:function(a){var b,c,d,e,f,g=3.2808399*a,h=this._iScaleFirstNumber,i=this._iScaleSecondNumber,j=this._iScale,k=this._iScaleLabel;k.innerHTML="0",g>2640?(b=g/5280,c=this._getRoundNum(b),e=this._getRoundNum(b/2),j.style.width=this._getScaleWidth(c/b)+"px",h.innerHTML=e,i.innerHTML=c+"mi"):(d=this._getRoundNum(g),f=this._getRoundNum(g/2),j.style.width=this._getScaleWidth(d/g)+"px",h.innerHTML=f,i.innerHTML=d+"ft")},_getScaleWidth:function(a){return Math.round(this.options.maxWidth*a)-10},_getRoundNum:function(a){if(a>=2){var b=Math.pow(10,(Math.floor(a)+"").length-1),c=a/b;return c=c>=10?10:c>=5?5:c>=3?3:c>=2?2:1,b*c}return(Math.round(100*a)/100).toFixed(1)}});
